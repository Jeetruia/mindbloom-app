{"ast":null,"code":"// Botpress Service Integration - Real API\n\nexport class BotpressService {\n  constructor(config) {\n    this.config = void 0;\n    this.conversationId = null;\n    this.isConnected = false;\n    this.messageQueue = [];\n    this.messageListeners = [];\n    this.config = config;\n    this.conversationId = config.conversationId || null;\n  }\n\n  // Initialize connection to Botpress\n  async initialize() {\n    try {\n      // Generate a unique conversation ID if not provided\n      if (!this.conversationId) {\n        this.conversationId = `conv_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n      }\n\n      // Test connection by making a simple API call\n      await this.testConnection();\n      this.isConnected = true;\n      console.log('Botpress service initialized successfully');\n    } catch (error) {\n      console.error('Failed to initialize Botpress service:', error);\n      this.isConnected = false;\n    }\n  }\n\n  // Test connection to Botpress\n  async testConnection() {\n    try {\n      // Make a test call to Botpress API\n      const response = await fetch('https://cdn.botpress.cloud/webchat/v3.2/shareable.html', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          type: 'text',\n          text: 'test',\n          userId: this.config.userId,\n          conversationId: this.conversationId,\n          botId: this.config.botId\n        })\n      });\n      if (!response.ok) {\n        throw new Error(`Botpress API error: ${response.status}`);\n      }\n    } catch (error) {\n      console.warn('Botpress API test failed, using fallback mode');\n      // Don't throw error, just mark as not connected\n    }\n  }\n\n  // Send message to Botpress and get response\n  async sendMessage(message) {\n    try {\n      if (!this.isConnected) {\n        console.warn('Botpress not connected, using fallback');\n        return this.getFallbackResponse(message);\n      }\n\n      // Send message to real Botpress API\n      const response = await fetch('https://cdn.botpress.cloud/webchat/v3.2/shareable.html', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          type: 'text',\n          text: message,\n          userId: this.config.userId,\n          conversationId: this.conversationId,\n          botId: this.config.botId\n        })\n      });\n      if (!response.ok) {\n        throw new Error(`Botpress API error: ${response.status}`);\n      }\n      const data = await response.json();\n      return this.parseBotpressResponse(data);\n    } catch (error) {\n      console.error('Error sending message to Botpress:', error);\n      return this.getFallbackResponse(message);\n    }\n  }\n\n  // Parse Botpress response format\n  parseBotpressResponse(data) {\n    const messages = [];\n    if (data.messages && Array.isArray(data.messages)) {\n      data.messages.forEach((msg, index) => {\n        messages.push({\n          id: msg.id || `msg_${Date.now()}_${index}`,\n          type: msg.type || 'text',\n          text: msg.text || msg.message || '',\n          data: msg.data,\n          timestamp: new Date()\n        });\n      });\n    } else if (data.text) {\n      messages.push({\n        id: `msg_${Date.now()}`,\n        type: 'text',\n        text: data.text,\n        timestamp: new Date()\n      });\n    } else {\n      // If no response, use fallback\n      return this.getFallbackResponse('fallback');\n    }\n    return messages;\n  }\n\n  // Fallback response when Botpress is unavailable\n  getFallbackResponse(message) {\n    const responses = [\"I'm here to listen and support you. How are you feeling today?\", \"Thank you for sharing that with me. I understand this might be difficult to talk about.\", \"I'm glad you reached out. Let's work through this together, one step at a time.\", \"Your feelings are valid, and it's okay to not be okay sometimes. I'm here to help.\", \"I can hear that you're going through a challenging time. You're not alone in this.\"];\n    const randomResponse = responses[Math.floor(Math.random() * responses.length)];\n    return [{\n      id: `fallback_${Date.now()}`,\n      type: 'text',\n      text: randomResponse,\n      timestamp: new Date()\n    }];\n  }\n\n  // Get initial greeting message\n  async getInitialGreeting() {\n    try {\n      // Try to get a personalized greeting from Botpress\n      const response = await this.sendMessage('start conversation');\n\n      // If no response or empty, use default greeting\n      if (response.length === 0 || !response[0].text) {\n        return [{\n          id: `greeting_${Date.now()}`,\n          type: 'text',\n          text: \"Hello! I'm Mira, your wellness guide. I'm here to listen and support you. How are you feeling today?\",\n          timestamp: new Date()\n        }];\n      }\n      return response;\n    } catch (error) {\n      console.warn('Failed to get Botpress greeting, using fallback:', error);\n      return [{\n        id: `greeting_${Date.now()}`,\n        type: 'text',\n        text: \"Hello! I'm Mira, your wellness guide. I'm here to listen and support you. How are you feeling today?\",\n        timestamp: new Date()\n      }];\n    }\n  }\n\n  // Check if service is connected\n  isServiceConnected() {\n    return this.isConnected;\n  }\n\n  // Get conversation ID\n  getConversationId() {\n    return this.conversationId;\n  }\n\n  // Show/hide the Botpress widget (placeholder for future implementation)\n  showWidget() {\n    console.log('Botpress widget show (not implemented yet)');\n  }\n  hideWidget() {\n    console.log('Botpress widget hide (not implemented yet)');\n  }\n}\n\n// Create a singleton instance with your specific Botpress configuration\nexport const botpressService = new BotpressService({\n  botId: '20250921130550-P1WEUHCI',\n  // Extracted from the configUrl\n  userId: 'user_' + Date.now(),\n  configUrl: 'https://files.bpcontent.cloud/2025/09/21/13/20250921130550-P1WEUHCI.json',\n  apiUrl: 'https://cdn.botpress.cloud/webchat/v3.2/shareable.html'\n});\n\n// Add global type declaration for window","map":{"version":3,"names":["BotpressService","constructor","config","conversationId","isConnected","messageQueue","messageListeners","initialize","Date","now","Math","random","toString","substr","testConnection","console","log","error","response","fetch","method","headers","body","JSON","stringify","type","text","userId","botId","ok","Error","status","warn","sendMessage","message","getFallbackResponse","data","json","parseBotpressResponse","messages","Array","isArray","forEach","msg","index","push","id","timestamp","responses","randomResponse","floor","length","getInitialGreeting","isServiceConnected","getConversationId","showWidget","hideWidget","botpressService","configUrl","apiUrl"],"sources":["/Users/jeetruia/MINDBLOOM/mindbloom-app/src/services/botpressService.ts"],"sourcesContent":["// Botpress Service Integration - Real API\nexport interface BotpressMessage {\n  id: string;\n  type: 'text' | 'image' | 'file' | 'card' | 'carousel' | 'quick_reply';\n  text?: string;\n  data?: any;\n  timestamp: Date;\n}\n\nexport interface BotpressConfig {\n  botId: string;\n  userId: string;\n  conversationId?: string;\n  configUrl: string;\n  apiUrl?: string;\n}\n\nexport class BotpressService {\n  private config: BotpressConfig;\n  private conversationId: string | null = null;\n  private isConnected = false;\n  private messageQueue: BotpressMessage[] = [];\n  private messageListeners: ((message: BotpressMessage) => void)[] = [];\n\n  constructor(config: BotpressConfig) {\n    this.config = config;\n    this.conversationId = config.conversationId || null;\n  }\n\n  // Initialize connection to Botpress\n  async initialize(): Promise<void> {\n    try {\n      // Generate a unique conversation ID if not provided\n      if (!this.conversationId) {\n        this.conversationId = `conv_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n      }\n\n      // Test connection by making a simple API call\n      await this.testConnection();\n      this.isConnected = true;\n      console.log('Botpress service initialized successfully');\n    } catch (error) {\n      console.error('Failed to initialize Botpress service:', error);\n      this.isConnected = false;\n    }\n  }\n\n  // Test connection to Botpress\n  private async testConnection(): Promise<void> {\n    try {\n      // Make a test call to Botpress API\n      const response = await fetch('https://cdn.botpress.cloud/webchat/v3.2/shareable.html', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          type: 'text',\n          text: 'test',\n          userId: this.config.userId,\n          conversationId: this.conversationId,\n          botId: this.config.botId\n        })\n      });\n\n      if (!response.ok) {\n        throw new Error(`Botpress API error: ${response.status}`);\n      }\n    } catch (error) {\n      console.warn('Botpress API test failed, using fallback mode');\n      // Don't throw error, just mark as not connected\n    }\n  }\n\n  // Send message to Botpress and get response\n  async sendMessage(message: string): Promise<BotpressMessage[]> {\n    try {\n      if (!this.isConnected) {\n        console.warn('Botpress not connected, using fallback');\n        return this.getFallbackResponse(message);\n      }\n\n      // Send message to real Botpress API\n      const response = await fetch('https://cdn.botpress.cloud/webchat/v3.2/shareable.html', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          type: 'text',\n          text: message,\n          userId: this.config.userId,\n          conversationId: this.conversationId,\n          botId: this.config.botId\n        })\n      });\n\n      if (!response.ok) {\n        throw new Error(`Botpress API error: ${response.status}`);\n      }\n\n      const data = await response.json();\n      return this.parseBotpressResponse(data);\n    } catch (error) {\n      console.error('Error sending message to Botpress:', error);\n      return this.getFallbackResponse(message);\n    }\n  }\n\n  // Parse Botpress response format\n  private parseBotpressResponse(data: any): BotpressMessage[] {\n    const messages: BotpressMessage[] = [];\n    \n    if (data.messages && Array.isArray(data.messages)) {\n      data.messages.forEach((msg: any, index: number) => {\n        messages.push({\n          id: msg.id || `msg_${Date.now()}_${index}`,\n          type: msg.type || 'text',\n          text: msg.text || msg.message || '',\n          data: msg.data,\n          timestamp: new Date()\n        });\n      });\n    } else if (data.text) {\n      messages.push({\n        id: `msg_${Date.now()}`,\n        type: 'text',\n        text: data.text,\n        timestamp: new Date()\n      });\n    } else {\n      // If no response, use fallback\n      return this.getFallbackResponse('fallback');\n    }\n\n    return messages;\n  }\n\n  // Fallback response when Botpress is unavailable\n  private getFallbackResponse(message: string): BotpressMessage[] {\n    const responses = [\n      \"I'm here to listen and support you. How are you feeling today?\",\n      \"Thank you for sharing that with me. I understand this might be difficult to talk about.\",\n      \"I'm glad you reached out. Let's work through this together, one step at a time.\",\n      \"Your feelings are valid, and it's okay to not be okay sometimes. I'm here to help.\",\n      \"I can hear that you're going through a challenging time. You're not alone in this.\"\n    ];\n\n    const randomResponse = responses[Math.floor(Math.random() * responses.length)];\n    \n    return [{\n      id: `fallback_${Date.now()}`,\n      type: 'text',\n      text: randomResponse,\n      timestamp: new Date()\n    }];\n  }\n\n  // Get initial greeting message\n  async getInitialGreeting(): Promise<BotpressMessage[]> {\n    try {\n      // Try to get a personalized greeting from Botpress\n      const response = await this.sendMessage('start conversation');\n      \n      // If no response or empty, use default greeting\n      if (response.length === 0 || !response[0].text) {\n        return [{\n          id: `greeting_${Date.now()}`,\n          type: 'text',\n          text: \"Hello! I'm Mira, your wellness guide. I'm here to listen and support you. How are you feeling today?\",\n          timestamp: new Date()\n        }];\n      }\n      \n      return response;\n    } catch (error) {\n      console.warn('Failed to get Botpress greeting, using fallback:', error);\n      return [{\n        id: `greeting_${Date.now()}`,\n        type: 'text',\n        text: \"Hello! I'm Mira, your wellness guide. I'm here to listen and support you. How are you feeling today?\",\n        timestamp: new Date()\n      }];\n    }\n  }\n\n  // Check if service is connected\n  isServiceConnected(): boolean {\n    return this.isConnected;\n  }\n\n  // Get conversation ID\n  getConversationId(): string | null {\n    return this.conversationId;\n  }\n\n  // Show/hide the Botpress widget (placeholder for future implementation)\n  showWidget(): void {\n    console.log('Botpress widget show (not implemented yet)');\n  }\n\n  hideWidget(): void {\n    console.log('Botpress widget hide (not implemented yet)');\n  }\n}\n\n// Create a singleton instance with your specific Botpress configuration\nexport const botpressService = new BotpressService({\n  botId: '20250921130550-P1WEUHCI', // Extracted from the configUrl\n  userId: 'user_' + Date.now(),\n  configUrl: 'https://files.bpcontent.cloud/2025/09/21/13/20250921130550-P1WEUHCI.json',\n  apiUrl: 'https://cdn.botpress.cloud/webchat/v3.2/shareable.html'\n});\n\n// Add global type declaration for window\ndeclare global {\n  interface Window {\n    botpressWebChat?: any;\n  }\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}