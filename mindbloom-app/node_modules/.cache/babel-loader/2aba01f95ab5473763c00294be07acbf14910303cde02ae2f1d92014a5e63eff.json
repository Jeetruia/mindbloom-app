{"ast":null,"code":"// Botpress Service Integration - Real API\nexport class BotpressService{constructor(config){this.config=void 0;this.conversationId=null;this.isConnected=false;this.messageQueue=[];this.messageListeners=[];this.config=config;this.conversationId=config.conversationId||null;}// Initialize connection to Botpress\nasync initialize(){try{// Generate a unique conversation ID if not provided\nif(!this.conversationId){this.conversationId=\"conv_\".concat(Date.now(),\"_\").concat(Math.random().toString(36).substr(2,9));}// Test connection by making a simple API call\nawait this.testConnection();this.isConnected=true;console.log('Botpress service initialized successfully');}catch(error){console.error('Failed to initialize Botpress service:',error);this.isConnected=false;}}// Test connection to Botpress\nasync testConnection(){try{// Make a test call to Botpress API\nconst response=await fetch('https://cdn.botpress.cloud/webchat/v3.2/shareable.html',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({type:'text',text:'test',userId:this.config.userId,conversationId:this.conversationId,botId:this.config.botId})});if(!response.ok){throw new Error(\"Botpress API error: \".concat(response.status));}}catch(error){console.warn('Botpress API test failed, using fallback mode');// Don't throw error, just mark as not connected\n}}// Send message to Botpress and get response\nasync sendMessage(message){try{if(!this.isConnected){console.warn('Botpress not connected, using fallback');return this.getFallbackResponse(message);}// Send message to real Botpress API\nconst response=await fetch('https://cdn.botpress.cloud/webchat/v3.2/shareable.html',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({type:'text',text:message,userId:this.config.userId,conversationId:this.conversationId,botId:this.config.botId})});if(!response.ok){throw new Error(\"Botpress API error: \".concat(response.status));}const data=await response.json();return this.parseBotpressResponse(data);}catch(error){console.error('Error sending message to Botpress:',error);return this.getFallbackResponse(message);}}// Parse Botpress response format\nparseBotpressResponse(data){const messages=[];if(data.messages&&Array.isArray(data.messages)){data.messages.forEach((msg,index)=>{messages.push({id:msg.id||\"msg_\".concat(Date.now(),\"_\").concat(index),type:msg.type||'text',text:msg.text||msg.message||'',data:msg.data,timestamp:new Date()});});}else if(data.text){messages.push({id:\"msg_\".concat(Date.now()),type:'text',text:data.text,timestamp:new Date()});}else{// If no response, use fallback\nreturn this.getFallbackResponse('fallback');}return messages;}// Fallback response when Botpress is unavailable\ngetFallbackResponse(message){const responses=[\"I'm here to listen and support you. How are you feeling today?\",\"Thank you for sharing that with me. I understand this might be difficult to talk about.\",\"I'm glad you reached out. Let's work through this together, one step at a time.\",\"Your feelings are valid, and it's okay to not be okay sometimes. I'm here to help.\",\"I can hear that you're going through a challenging time. You're not alone in this.\"];const randomResponse=responses[Math.floor(Math.random()*responses.length)];return[{id:\"fallback_\".concat(Date.now()),type:'text',text:randomResponse,timestamp:new Date()}];}// Get initial greeting message\nasync getInitialGreeting(){try{// Try to get a personalized greeting from Botpress\nconst response=await this.sendMessage('start conversation');// If no response or empty, use default greeting\nif(response.length===0||!response[0].text){return[{id:\"greeting_\".concat(Date.now()),type:'text',text:\"Hello! I'm Mira, your wellness guide. I'm here to listen and support you. How are you feeling today?\",timestamp:new Date()}];}return response;}catch(error){console.warn('Failed to get Botpress greeting, using fallback:',error);return[{id:\"greeting_\".concat(Date.now()),type:'text',text:\"Hello! I'm Mira, your wellness guide. I'm here to listen and support you. How are you feeling today?\",timestamp:new Date()}];}}// Check if service is connected\nisServiceConnected(){return this.isConnected;}// Get conversation ID\ngetConversationId(){return this.conversationId;}// Show/hide the Botpress widget (placeholder for future implementation)\nshowWidget(){console.log('Botpress widget show (not implemented yet)');}hideWidget(){console.log('Botpress widget hide (not implemented yet)');}}// Create a singleton instance with your specific Botpress configuration\nexport const botpressService=new BotpressService({botId:'mindbloom-therapist',userId:'user_'+Date.now(),configUrl:'https://files.bpcontent.cloud/2025/09/21/13/20250921130550-P1WEUHCI.json',apiUrl:'https://cdn.botpress.cloud/webchat/v3.2/shareable.html'});// Add global type declaration for window","map":{"version":3,"names":["BotpressService","constructor","config","conversationId","isConnected","messageQueue","messageListeners","initialize","concat","Date","now","Math","random","toString","substr","testConnection","console","log","error","response","fetch","method","headers","body","JSON","stringify","type","text","userId","botId","ok","Error","status","warn","sendMessage","message","getFallbackResponse","data","json","parseBotpressResponse","messages","Array","isArray","forEach","msg","index","push","id","timestamp","responses","randomResponse","floor","length","getInitialGreeting","isServiceConnected","getConversationId","showWidget","hideWidget","botpressService","configUrl","apiUrl"],"sources":["/Users/jeetruia/MINDBLOOM/mindbloom-app/src/services/botpressService.ts"],"sourcesContent":["// Botpress Service Integration - Real API\nexport interface BotpressMessage {\n  id: string;\n  type: 'text' | 'image' | 'file' | 'card' | 'carousel' | 'quick_reply';\n  text?: string;\n  data?: any;\n  timestamp: Date;\n}\n\nexport interface BotpressConfig {\n  botId: string;\n  userId: string;\n  conversationId?: string;\n  configUrl: string;\n  apiUrl?: string;\n}\n\nexport class BotpressService {\n  private config: BotpressConfig;\n  private conversationId: string | null = null;\n  private isConnected = false;\n  private messageQueue: BotpressMessage[] = [];\n  private messageListeners: ((message: BotpressMessage) => void)[] = [];\n\n  constructor(config: BotpressConfig) {\n    this.config = config;\n    this.conversationId = config.conversationId || null;\n  }\n\n  // Initialize connection to Botpress\n  async initialize(): Promise<void> {\n    try {\n      // Generate a unique conversation ID if not provided\n      if (!this.conversationId) {\n        this.conversationId = `conv_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n      }\n\n      // Test connection by making a simple API call\n      await this.testConnection();\n      this.isConnected = true;\n      console.log('Botpress service initialized successfully');\n    } catch (error) {\n      console.error('Failed to initialize Botpress service:', error);\n      this.isConnected = false;\n    }\n  }\n\n  // Test connection to Botpress\n  private async testConnection(): Promise<void> {\n    try {\n      // Make a test call to Botpress API\n      const response = await fetch('https://cdn.botpress.cloud/webchat/v3.2/shareable.html', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          type: 'text',\n          text: 'test',\n          userId: this.config.userId,\n          conversationId: this.conversationId,\n          botId: this.config.botId\n        })\n      });\n\n      if (!response.ok) {\n        throw new Error(`Botpress API error: ${response.status}`);\n      }\n    } catch (error) {\n      console.warn('Botpress API test failed, using fallback mode');\n      // Don't throw error, just mark as not connected\n    }\n  }\n\n  // Send message to Botpress and get response\n  async sendMessage(message: string): Promise<BotpressMessage[]> {\n    try {\n      if (!this.isConnected) {\n        console.warn('Botpress not connected, using fallback');\n        return this.getFallbackResponse(message);\n      }\n\n      // Send message to real Botpress API\n      const response = await fetch('https://cdn.botpress.cloud/webchat/v3.2/shareable.html', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          type: 'text',\n          text: message,\n          userId: this.config.userId,\n          conversationId: this.conversationId,\n          botId: this.config.botId\n        })\n      });\n\n      if (!response.ok) {\n        throw new Error(`Botpress API error: ${response.status}`);\n      }\n\n      const data = await response.json();\n      return this.parseBotpressResponse(data);\n    } catch (error) {\n      console.error('Error sending message to Botpress:', error);\n      return this.getFallbackResponse(message);\n    }\n  }\n\n  // Parse Botpress response format\n  private parseBotpressResponse(data: any): BotpressMessage[] {\n    const messages: BotpressMessage[] = [];\n    \n    if (data.messages && Array.isArray(data.messages)) {\n      data.messages.forEach((msg: any, index: number) => {\n        messages.push({\n          id: msg.id || `msg_${Date.now()}_${index}`,\n          type: msg.type || 'text',\n          text: msg.text || msg.message || '',\n          data: msg.data,\n          timestamp: new Date()\n        });\n      });\n    } else if (data.text) {\n      messages.push({\n        id: `msg_${Date.now()}`,\n        type: 'text',\n        text: data.text,\n        timestamp: new Date()\n      });\n    } else {\n      // If no response, use fallback\n      return this.getFallbackResponse('fallback');\n    }\n\n    return messages;\n  }\n\n  // Fallback response when Botpress is unavailable\n  private getFallbackResponse(message: string): BotpressMessage[] {\n    const responses = [\n      \"I'm here to listen and support you. How are you feeling today?\",\n      \"Thank you for sharing that with me. I understand this might be difficult to talk about.\",\n      \"I'm glad you reached out. Let's work through this together, one step at a time.\",\n      \"Your feelings are valid, and it's okay to not be okay sometimes. I'm here to help.\",\n      \"I can hear that you're going through a challenging time. You're not alone in this.\"\n    ];\n\n    const randomResponse = responses[Math.floor(Math.random() * responses.length)];\n    \n    return [{\n      id: `fallback_${Date.now()}`,\n      type: 'text',\n      text: randomResponse,\n      timestamp: new Date()\n    }];\n  }\n\n  // Get initial greeting message\n  async getInitialGreeting(): Promise<BotpressMessage[]> {\n    try {\n      // Try to get a personalized greeting from Botpress\n      const response = await this.sendMessage('start conversation');\n      \n      // If no response or empty, use default greeting\n      if (response.length === 0 || !response[0].text) {\n        return [{\n          id: `greeting_${Date.now()}`,\n          type: 'text',\n          text: \"Hello! I'm Mira, your wellness guide. I'm here to listen and support you. How are you feeling today?\",\n          timestamp: new Date()\n        }];\n      }\n      \n      return response;\n    } catch (error) {\n      console.warn('Failed to get Botpress greeting, using fallback:', error);\n      return [{\n        id: `greeting_${Date.now()}`,\n        type: 'text',\n        text: \"Hello! I'm Mira, your wellness guide. I'm here to listen and support you. How are you feeling today?\",\n        timestamp: new Date()\n      }];\n    }\n  }\n\n  // Check if service is connected\n  isServiceConnected(): boolean {\n    return this.isConnected;\n  }\n\n  // Get conversation ID\n  getConversationId(): string | null {\n    return this.conversationId;\n  }\n\n  // Show/hide the Botpress widget (placeholder for future implementation)\n  showWidget(): void {\n    console.log('Botpress widget show (not implemented yet)');\n  }\n\n  hideWidget(): void {\n    console.log('Botpress widget hide (not implemented yet)');\n  }\n}\n\n// Create a singleton instance with your specific Botpress configuration\nexport const botpressService = new BotpressService({\n  botId: 'mindbloom-therapist',\n  userId: 'user_' + Date.now(),\n  configUrl: 'https://files.bpcontent.cloud/2025/09/21/13/20250921130550-P1WEUHCI.json',\n  apiUrl: 'https://cdn.botpress.cloud/webchat/v3.2/shareable.html'\n});\n\n// Add global type declaration for window\ndeclare global {\n  interface Window {\n    botpressWebChat?: any;\n  }\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}