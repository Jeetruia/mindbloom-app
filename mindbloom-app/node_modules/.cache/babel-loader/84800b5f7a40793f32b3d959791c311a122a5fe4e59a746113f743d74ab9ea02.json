{"ast":null,"code":"// Botpress Service Integration\n\nexport class BotpressService {\n  constructor(config) {\n    this.config = void 0;\n    this.conversationId = null;\n    this.isConnected = false;\n    this.config = config;\n    this.conversationId = config.conversationId || null;\n  }\n\n  // Initialize connection to Botpress\n  async initialize() {\n    try {\n      // Generate a unique conversation ID if not provided\n      if (!this.conversationId) {\n        this.conversationId = `conv_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n      }\n\n      // Test connection by sending a ping\n      await this.sendMessage('ping');\n      this.isConnected = true;\n      console.log('Botpress service initialized successfully');\n    } catch (error) {\n      console.error('Failed to initialize Botpress service:', error);\n      // Don't throw error, just mark as not connected\n      this.isConnected = false;\n    }\n  }\n\n  // Send message to Botpress and get response\n  async sendMessage(message) {\n    try {\n      // For now, we'll use a mock response since the Botpress API requires specific configuration\n      // In a real implementation, you would use the actual Botpress API\n      console.log('Sending message to Botpress:', message);\n\n      // Simulate API call delay\n      await new Promise(resolve => setTimeout(resolve, 1000));\n\n      // Return a mock response for now\n      return this.getMockResponse(message);\n    } catch (error) {\n      console.error('Error sending message to Botpress:', error);\n      // Fallback to local AI response\n      return this.getFallbackResponse(message);\n    }\n  }\n\n  // Mock response for testing\n  getMockResponse(message) {\n    const responses = [\"I understand you're going through a difficult time. I'm here to listen and support you.\", \"Thank you for sharing that with me. It takes courage to open up about your feelings.\", \"I can hear that you're feeling overwhelmed. Let's work through this together, one step at a time.\", \"Your feelings are completely valid. Sometimes just talking about what's on your mind can help.\", \"I'm glad you reached out. You're not alone in this, and I'm here to help you through it.\", \"That sounds really challenging. I want you to know that it's okay to not be okay sometimes.\", \"I appreciate you trusting me with your thoughts. Let's explore some strategies that might help you feel better.\", \"I can sense the strength in your words, even when things feel difficult. You're doing better than you might think.\"];\n    const randomResponse = responses[Math.floor(Math.random() * responses.length)];\n    return [{\n      id: `botpress_${Date.now()}`,\n      type: 'text',\n      text: randomResponse,\n      timestamp: new Date()\n    }];\n  }\n\n  // Parse Botpress response format\n  parseBotpressResponse(data) {\n    const messages = [];\n    if (data.messages && Array.isArray(data.messages)) {\n      data.messages.forEach((msg, index) => {\n        messages.push({\n          id: msg.id || `msg_${Date.now()}_${index}`,\n          type: msg.type || 'text',\n          text: msg.text || msg.message || '',\n          data: msg.data,\n          timestamp: new Date()\n        });\n      });\n    } else if (data.text) {\n      messages.push({\n        id: `msg_${Date.now()}`,\n        type: 'text',\n        text: data.text,\n        timestamp: new Date()\n      });\n    }\n    return messages;\n  }\n\n  // Fallback response when Botpress is unavailable\n  getFallbackResponse(message) {\n    const responses = [\"I'm here to listen and support you. How are you feeling today?\", \"Thank you for sharing that with me. I understand this might be difficult to talk about.\", \"I'm glad you reached out. Let's work through this together, one step at a time.\", \"Your feelings are valid, and it's okay to not be okay sometimes. I'm here to help.\", \"I can hear that you're going through a challenging time. You're not alone in this.\"];\n    const randomResponse = responses[Math.floor(Math.random() * responses.length)];\n    return [{\n      id: `fallback_${Date.now()}`,\n      type: 'text',\n      text: randomResponse,\n      timestamp: new Date()\n    }];\n  }\n\n  // Get initial greeting message\n  async getInitialGreeting() {\n    try {\n      // Try to get a personalized greeting from Botpress\n      const response = await this.sendMessage('start conversation');\n\n      // If no response or empty, use default greeting\n      if (response.length === 0 || !response[0].text) {\n        return [{\n          id: `greeting_${Date.now()}`,\n          type: 'text',\n          text: \"Hello! I'm Mira, your wellness guide. I'm here to listen and support you. How are you feeling today?\",\n          timestamp: new Date()\n        }];\n      }\n      return response;\n    } catch (error) {\n      console.warn('Failed to get Botpress greeting, using fallback:', error);\n      return [{\n        id: `greeting_${Date.now()}`,\n        type: 'text',\n        text: \"Hello! I'm Mira, your wellness guide. I'm here to listen and support you. How are you feeling today?\",\n        timestamp: new Date()\n      }];\n    }\n  }\n\n  // Check if service is connected\n  isServiceConnected() {\n    return this.isConnected;\n  }\n\n  // Get conversation ID\n  getConversationId() {\n    return this.conversationId;\n  }\n}\n\n// Create a singleton instance\nexport const botpressService = new BotpressService({\n  botId: 'mindbloom-therapist',\n  userId: 'user_' + Date.now(),\n  apiUrl: 'https://cdn.botpress.cloud/webchat/v3.2/shareable.html'\n});\n\n// Add global type declaration for window","map":{"version":3,"names":["BotpressService","constructor","config","conversationId","isConnected","initialize","Date","now","Math","random","toString","substr","sendMessage","console","log","error","message","Promise","resolve","setTimeout","getMockResponse","getFallbackResponse","responses","randomResponse","floor","length","id","type","text","timestamp","parseBotpressResponse","data","messages","Array","isArray","forEach","msg","index","push","getInitialGreeting","response","warn","isServiceConnected","getConversationId","botpressService","botId","userId","apiUrl"],"sources":["/Users/jeetruia/MINDBLOOM/mindbloom-app/src/services/botpressService.ts"],"sourcesContent":["// Botpress Service Integration\nexport interface BotpressMessage {\n  id: string;\n  type: 'text' | 'image' | 'file' | 'card' | 'carousel' | 'quick_reply';\n  text?: string;\n  data?: any;\n  timestamp: Date;\n}\n\nexport interface BotpressConfig {\n  botId: string;\n  userId: string;\n  conversationId?: string;\n  configUrl: string;\n  apiUrl?: string;\n}\n\nexport class BotpressService {\n  private config: BotpressConfig;\n  private conversationId: string | null = null;\n  private isConnected = false;\n\n  constructor(config: BotpressConfig) {\n    this.config = config;\n    this.conversationId = config.conversationId || null;\n  }\n\n  // Initialize connection to Botpress\n  async initialize(): Promise<void> {\n    try {\n      // Generate a unique conversation ID if not provided\n      if (!this.conversationId) {\n        this.conversationId = `conv_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n      }\n\n      // Test connection by sending a ping\n      await this.sendMessage('ping');\n      this.isConnected = true;\n      console.log('Botpress service initialized successfully');\n    } catch (error) {\n      console.error('Failed to initialize Botpress service:', error);\n      // Don't throw error, just mark as not connected\n      this.isConnected = false;\n    }\n  }\n\n  // Send message to Botpress and get response\n  async sendMessage(message: string): Promise<BotpressMessage[]> {\n    try {\n      // For now, we'll use a mock response since the Botpress API requires specific configuration\n      // In a real implementation, you would use the actual Botpress API\n      console.log('Sending message to Botpress:', message);\n      \n      // Simulate API call delay\n      await new Promise(resolve => setTimeout(resolve, 1000));\n      \n      // Return a mock response for now\n      return this.getMockResponse(message);\n    } catch (error) {\n      console.error('Error sending message to Botpress:', error);\n      // Fallback to local AI response\n      return this.getFallbackResponse(message);\n    }\n  }\n\n  // Mock response for testing\n  private getMockResponse(message: string): BotpressMessage[] {\n    const responses = [\n      \"I understand you're going through a difficult time. I'm here to listen and support you.\",\n      \"Thank you for sharing that with me. It takes courage to open up about your feelings.\",\n      \"I can hear that you're feeling overwhelmed. Let's work through this together, one step at a time.\",\n      \"Your feelings are completely valid. Sometimes just talking about what's on your mind can help.\",\n      \"I'm glad you reached out. You're not alone in this, and I'm here to help you through it.\",\n      \"That sounds really challenging. I want you to know that it's okay to not be okay sometimes.\",\n      \"I appreciate you trusting me with your thoughts. Let's explore some strategies that might help you feel better.\",\n      \"I can sense the strength in your words, even when things feel difficult. You're doing better than you might think.\"\n    ];\n\n    const randomResponse = responses[Math.floor(Math.random() * responses.length)];\n    \n    return [{\n      id: `botpress_${Date.now()}`,\n      type: 'text',\n      text: randomResponse,\n      timestamp: new Date()\n    }];\n  }\n\n  // Parse Botpress response format\n  private parseBotpressResponse(data: any): BotpressMessage[] {\n    const messages: BotpressMessage[] = [];\n    \n    if (data.messages && Array.isArray(data.messages)) {\n      data.messages.forEach((msg: any, index: number) => {\n        messages.push({\n          id: msg.id || `msg_${Date.now()}_${index}`,\n          type: msg.type || 'text',\n          text: msg.text || msg.message || '',\n          data: msg.data,\n          timestamp: new Date()\n        });\n      });\n    } else if (data.text) {\n      messages.push({\n        id: `msg_${Date.now()}`,\n        type: 'text',\n        text: data.text,\n        timestamp: new Date()\n      });\n    }\n\n    return messages;\n  }\n\n  // Fallback response when Botpress is unavailable\n  private getFallbackResponse(message: string): BotpressMessage[] {\n    const responses = [\n      \"I'm here to listen and support you. How are you feeling today?\",\n      \"Thank you for sharing that with me. I understand this might be difficult to talk about.\",\n      \"I'm glad you reached out. Let's work through this together, one step at a time.\",\n      \"Your feelings are valid, and it's okay to not be okay sometimes. I'm here to help.\",\n      \"I can hear that you're going through a challenging time. You're not alone in this.\"\n    ];\n\n    const randomResponse = responses[Math.floor(Math.random() * responses.length)];\n    \n    return [{\n      id: `fallback_${Date.now()}`,\n      type: 'text',\n      text: randomResponse,\n      timestamp: new Date()\n    }];\n  }\n\n  // Get initial greeting message\n  async getInitialGreeting(): Promise<BotpressMessage[]> {\n    try {\n      // Try to get a personalized greeting from Botpress\n      const response = await this.sendMessage('start conversation');\n      \n      // If no response or empty, use default greeting\n      if (response.length === 0 || !response[0].text) {\n        return [{\n          id: `greeting_${Date.now()}`,\n          type: 'text',\n          text: \"Hello! I'm Mira, your wellness guide. I'm here to listen and support you. How are you feeling today?\",\n          timestamp: new Date()\n        }];\n      }\n      \n      return response;\n    } catch (error) {\n      console.warn('Failed to get Botpress greeting, using fallback:', error);\n      return [{\n        id: `greeting_${Date.now()}`,\n        type: 'text',\n        text: \"Hello! I'm Mira, your wellness guide. I'm here to listen and support you. How are you feeling today?\",\n        timestamp: new Date()\n      }];\n    }\n  }\n\n  // Check if service is connected\n  isServiceConnected(): boolean {\n    return this.isConnected;\n  }\n\n  // Get conversation ID\n  getConversationId(): string | null {\n    return this.conversationId;\n  }\n}\n\n// Create a singleton instance\nexport const botpressService = new BotpressService({\n  botId: 'mindbloom-therapist',\n  userId: 'user_' + Date.now(),\n  apiUrl: 'https://cdn.botpress.cloud/webchat/v3.2/shareable.html'\n});\n\n// Add global type declaration for window\ndeclare global {\n  interface Window {\n    botpressWebChat?: any;\n  }\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}