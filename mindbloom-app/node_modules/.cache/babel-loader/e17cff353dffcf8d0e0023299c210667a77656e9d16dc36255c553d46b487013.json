{"ast":null,"code":"// Botpress Service Integration\n\nexport class BotpressService {\n  constructor(config) {\n    this.config = void 0;\n    this.conversationId = null;\n    this.isConnected = false;\n    this.botpressWidget = null;\n    this.config = config;\n    this.conversationId = config.conversationId || null;\n  }\n\n  // Initialize connection to Botpress\n  async initialize() {\n    try {\n      // Generate a unique conversation ID if not provided\n      if (!this.conversationId) {\n        this.conversationId = `conv_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n      }\n\n      // Load Botpress webchat widget\n      await this.loadBotpressWidget();\n      this.isConnected = true;\n      console.log('Botpress service initialized successfully');\n    } catch (error) {\n      console.error('Failed to initialize Botpress service:', error);\n      throw error;\n    }\n  }\n\n  // Load Botpress webchat widget\n  async loadBotpressWidget() {\n    return new Promise((resolve, reject) => {\n      // Check if Botpress is already loaded\n      if (window.botpressWebChat) {\n        resolve();\n        return;\n      }\n\n      // Load Botpress webchat script\n      const script = document.createElement('script');\n      script.src = 'https://cdn.botpress.cloud/webchat/v3.2/shareable.html';\n      script.onload = () => {\n        if (window.botpressWebChat) {\n          this.botpressWidget = window.botpressWebChat;\n          resolve();\n        } else {\n          reject(new Error('Botpress webchat failed to load'));\n        }\n      };\n      script.onerror = () => reject(new Error('Failed to load Botpress script'));\n      document.head.appendChild(script);\n    });\n  }\n\n  // Send message to Botpress and get response\n  async sendMessage(message) {\n    try {\n      // Use the Botpress webchat API endpoint\n      const response = await fetch('https://cdn.botpress.cloud/webchat/v3.2/shareable.html', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          type: 'text',\n          text: message,\n          userId: this.config.userId,\n          conversationId: this.conversationId,\n          botId: this.config.botId\n        })\n      });\n      if (!response.ok) {\n        throw new Error(`Botpress API error: ${response.status}`);\n      }\n      const data = await response.json();\n      return this.parseBotpressResponse(data);\n    } catch (error) {\n      console.error('Error sending message to Botpress:', error);\n      // Fallback to local AI response\n      return this.getFallbackResponse(message);\n    }\n  }\n\n  // Parse Botpress response format\n  parseBotpressResponse(data) {\n    const messages = [];\n    if (data.messages && Array.isArray(data.messages)) {\n      data.messages.forEach((msg, index) => {\n        messages.push({\n          id: msg.id || `msg_${Date.now()}_${index}`,\n          type: msg.type || 'text',\n          text: msg.text || msg.message || '',\n          data: msg.data,\n          timestamp: new Date()\n        });\n      });\n    } else if (data.text) {\n      messages.push({\n        id: `msg_${Date.now()}`,\n        type: 'text',\n        text: data.text,\n        timestamp: new Date()\n      });\n    }\n    return messages;\n  }\n\n  // Fallback response when Botpress is unavailable\n  getFallbackResponse(message) {\n    const responses = [\"I'm here to listen and support you. How are you feeling today?\", \"Thank you for sharing that with me. I understand this might be difficult to talk about.\", \"I'm glad you reached out. Let's work through this together, one step at a time.\", \"Your feelings are valid, and it's okay to not be okay sometimes. I'm here to help.\", \"I can hear that you're going through a challenging time. You're not alone in this.\"];\n    const randomResponse = responses[Math.floor(Math.random() * responses.length)];\n    return [{\n      id: `fallback_${Date.now()}`,\n      type: 'text',\n      text: randomResponse,\n      timestamp: new Date()\n    }];\n  }\n\n  // Get initial greeting message\n  async getInitialGreeting() {\n    try {\n      // Try to get a personalized greeting from Botpress\n      const response = await this.sendMessage('start conversation');\n\n      // If no response or empty, use default greeting\n      if (response.length === 0 || !response[0].text) {\n        return [{\n          id: `greeting_${Date.now()}`,\n          type: 'text',\n          text: \"Hello! I'm Mira, your wellness guide. I'm here to listen and support you. How are you feeling today?\",\n          timestamp: new Date()\n        }];\n      }\n      return response;\n    } catch (error) {\n      console.warn('Failed to get Botpress greeting, using fallback:', error);\n      return [{\n        id: `greeting_${Date.now()}`,\n        type: 'text',\n        text: \"Hello! I'm Mira, your wellness guide. I'm here to listen and support you. How are you feeling today?\",\n        timestamp: new Date()\n      }];\n    }\n  }\n\n  // Check if service is connected\n  isServiceConnected() {\n    return this.isConnected;\n  }\n\n  // Get conversation ID\n  getConversationId() {\n    return this.conversationId;\n  }\n}\n\n// Create a singleton instance\nexport const botpressService = new BotpressService({\n  botId: 'mindbloom-therapist',\n  userId: 'user_' + Date.now(),\n  apiUrl: 'https://cdn.botpress.cloud/webchat/v3.2/shareable.html'\n});","map":{"version":3,"names":["BotpressService","constructor","config","conversationId","isConnected","botpressWidget","initialize","Date","now","Math","random","toString","substr","loadBotpressWidget","console","log","error","Promise","resolve","reject","window","botpressWebChat","script","document","createElement","src","onload","Error","onerror","head","appendChild","sendMessage","message","response","fetch","method","headers","body","JSON","stringify","type","text","userId","botId","ok","status","data","json","parseBotpressResponse","getFallbackResponse","messages","Array","isArray","forEach","msg","index","push","id","timestamp","responses","randomResponse","floor","length","getInitialGreeting","warn","isServiceConnected","getConversationId","botpressService","apiUrl"],"sources":["/Users/jeetruia/MINDBLOOM/mindbloom-app/src/services/botpressService.ts"],"sourcesContent":["// Botpress Service Integration\nexport interface BotpressMessage {\n  id: string;\n  type: 'text' | 'image' | 'file' | 'card' | 'carousel' | 'quick_reply';\n  text?: string;\n  data?: any;\n  timestamp: Date;\n}\n\nexport interface BotpressConfig {\n  botId: string;\n  userId: string;\n  conversationId?: string;\n  apiUrl?: string;\n}\n\nexport class BotpressService {\n  private config: BotpressConfig;\n  private conversationId: string | null = null;\n  private isConnected = false;\n  private botpressWidget: any = null;\n\n  constructor(config: BotpressConfig) {\n    this.config = config;\n    this.conversationId = config.conversationId || null;\n  }\n\n  // Initialize connection to Botpress\n  async initialize(): Promise<void> {\n    try {\n      // Generate a unique conversation ID if not provided\n      if (!this.conversationId) {\n        this.conversationId = `conv_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n      }\n\n      // Load Botpress webchat widget\n      await this.loadBotpressWidget();\n      this.isConnected = true;\n      console.log('Botpress service initialized successfully');\n    } catch (error) {\n      console.error('Failed to initialize Botpress service:', error);\n      throw error;\n    }\n  }\n\n  // Load Botpress webchat widget\n  private async loadBotpressWidget(): Promise<void> {\n    return new Promise((resolve, reject) => {\n      // Check if Botpress is already loaded\n      if (window.botpressWebChat) {\n        resolve();\n        return;\n      }\n\n      // Load Botpress webchat script\n      const script = document.createElement('script');\n      script.src = 'https://cdn.botpress.cloud/webchat/v3.2/shareable.html';\n      script.onload = () => {\n        if (window.botpressWebChat) {\n          this.botpressWidget = window.botpressWebChat;\n          resolve();\n        } else {\n          reject(new Error('Botpress webchat failed to load'));\n        }\n      };\n      script.onerror = () => reject(new Error('Failed to load Botpress script'));\n      document.head.appendChild(script);\n    });\n  }\n\n  // Send message to Botpress and get response\n  async sendMessage(message: string): Promise<BotpressMessage[]> {\n    try {\n      // Use the Botpress webchat API endpoint\n      const response = await fetch('https://cdn.botpress.cloud/webchat/v3.2/shareable.html', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          type: 'text',\n          text: message,\n          userId: this.config.userId,\n          conversationId: this.conversationId,\n          botId: this.config.botId\n        })\n      });\n\n      if (!response.ok) {\n        throw new Error(`Botpress API error: ${response.status}`);\n      }\n\n      const data = await response.json();\n      return this.parseBotpressResponse(data);\n    } catch (error) {\n      console.error('Error sending message to Botpress:', error);\n      // Fallback to local AI response\n      return this.getFallbackResponse(message);\n    }\n  }\n\n  // Parse Botpress response format\n  private parseBotpressResponse(data: any): BotpressMessage[] {\n    const messages: BotpressMessage[] = [];\n    \n    if (data.messages && Array.isArray(data.messages)) {\n      data.messages.forEach((msg: any, index: number) => {\n        messages.push({\n          id: msg.id || `msg_${Date.now()}_${index}`,\n          type: msg.type || 'text',\n          text: msg.text || msg.message || '',\n          data: msg.data,\n          timestamp: new Date()\n        });\n      });\n    } else if (data.text) {\n      messages.push({\n        id: `msg_${Date.now()}`,\n        type: 'text',\n        text: data.text,\n        timestamp: new Date()\n      });\n    }\n\n    return messages;\n  }\n\n  // Fallback response when Botpress is unavailable\n  private getFallbackResponse(message: string): BotpressMessage[] {\n    const responses = [\n      \"I'm here to listen and support you. How are you feeling today?\",\n      \"Thank you for sharing that with me. I understand this might be difficult to talk about.\",\n      \"I'm glad you reached out. Let's work through this together, one step at a time.\",\n      \"Your feelings are valid, and it's okay to not be okay sometimes. I'm here to help.\",\n      \"I can hear that you're going through a challenging time. You're not alone in this.\"\n    ];\n\n    const randomResponse = responses[Math.floor(Math.random() * responses.length)];\n    \n    return [{\n      id: `fallback_${Date.now()}`,\n      type: 'text',\n      text: randomResponse,\n      timestamp: new Date()\n    }];\n  }\n\n  // Get initial greeting message\n  async getInitialGreeting(): Promise<BotpressMessage[]> {\n    try {\n      // Try to get a personalized greeting from Botpress\n      const response = await this.sendMessage('start conversation');\n      \n      // If no response or empty, use default greeting\n      if (response.length === 0 || !response[0].text) {\n        return [{\n          id: `greeting_${Date.now()}`,\n          type: 'text',\n          text: \"Hello! I'm Mira, your wellness guide. I'm here to listen and support you. How are you feeling today?\",\n          timestamp: new Date()\n        }];\n      }\n      \n      return response;\n    } catch (error) {\n      console.warn('Failed to get Botpress greeting, using fallback:', error);\n      return [{\n        id: `greeting_${Date.now()}`,\n        type: 'text',\n        text: \"Hello! I'm Mira, your wellness guide. I'm here to listen and support you. How are you feeling today?\",\n        timestamp: new Date()\n      }];\n    }\n  }\n\n  // Check if service is connected\n  isServiceConnected(): boolean {\n    return this.isConnected;\n  }\n\n  // Get conversation ID\n  getConversationId(): string | null {\n    return this.conversationId;\n  }\n}\n\n// Create a singleton instance\nexport const botpressService = new BotpressService({\n  botId: 'mindbloom-therapist',\n  userId: 'user_' + Date.now(),\n  apiUrl: 'https://cdn.botpress.cloud/webchat/v3.2/shareable.html'\n});\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}